<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Earnings Intelligence ‚Äî Trendlyne Analyzer</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Mono:wght@300;400;500&family=Syne:wght@700;800&display=swap" rel="stylesheet"/>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body { background: #0a0a0f; }
@keyframes fadeIn { from{opacity:0;transform:translateY(4px)} to{opacity:1;transform:translateY(0)} }
@keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:.4;transform:scale(.8)} }
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0} }
@keyframes drift1 { 0%,100%{transform:translate(0,0)} 50%{transform:translate(-40px,40px)} }
@keyframes drift2 { 0%,100%{transform:translate(0,0)} 50%{transform:translate(30px,-30px)} }
input:focus { border-color: #e8ff47 !important; box-shadow: 0 0 0 3px rgba(232,255,71,0.1) !important; }
input { outline: none; }
::-webkit-scrollbar{width:4px}
::-webkit-scrollbar-thumb{background:#1e1e2e;border-radius:2px}
input[type="date"]::-webkit-calendar-picker-indicator{filter:invert(0.5);cursor:pointer}
</style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useRef, useEffect } = React;

const API_BASE = "https://earnings-intelligence-api.onrender.com";

const ANALYSIS_PROMPT = `You are an expert equity research analyst with deep expertise in fundamental analysis, behavioral finance, industry dynamics, and technical interpretation.
I will provide the quarterly earnings call transcript of a publicly traded company.
Your job is to perform a comprehensive qualitative and quantitative analysis and determine if the stock is a good long-term hold.

‚öôÔ∏è ANALYSIS FRAMEWORK

PART 1 ‚Äî CORE FUNDAMENTAL ASSESSMENT
Present findings using üü¢ Green (Positive), üî¥ Red (Negative), and ‚ö™ Grey (Neutral) indicators.
1Ô∏è‚É£ Management Tone & Confidence
2Ô∏è‚É£ Business Performance ‚Äì revenue, profit, margins, EPS, cash flow, debt (YoY & QoQ)
3Ô∏è‚É£ Growth Drivers ‚Äì products, markets, partnerships, R&D, acquisitions
4Ô∏è‚É£ Risks & Challenges ‚Äì competitive threats, macro, cost pressures, regulatory
5Ô∏è‚É£ Industry & Market Outlook
6Ô∏è‚É£ Capital Allocation & Shareholder Returns
7Ô∏è‚É£ Guidance & Forecast
8Ô∏è‚É£ Sentiment Analysis
9Ô∏è‚É£ Investment Rating ‚Äì Strong Buy / Buy / Cautious / Sell
üîü Final Verdict

PART 2 ‚Äî STRATEGIC QUALITY CHECK
‚Ä¢ Is multi-year ROE/ROCE rising and consistent?
‚Ä¢ Is management integrity unquestionable?
‚Ä¢ Is it a market leader with strong competitive moats?
‚Ä¢ Is cash flow conversion high (OCF/PAT > 1)?
‚Ä¢ DuPont ROE analysis insights?
‚Ä¢ Are sector/macro trends favorable?
‚Ä¢ Visible scalability and long-term compounding potential?
‚Ä¢ Category winner or turnaround candidate?
‚Ä¢ Sound capital allocation and shareholder alignment?
‚Ä¢ Are earnings, revenue, EPS consistently growing?
‚Ä¢ Are margins stable or expanding, debt manageable?
‚Ä¢ Resilient during downturns (e.g., COVID)?
‚Ä¢ Strong unit economics with pricing power?
‚Ä¢ Recent strategic shifts, leadership changes, product launches?

PART 3 ‚Äî CATALYST TABLE
| Catalyst | Positive/Neutral/Negative | Key Evidence | Potential Stock Impact |
|---|---|---|---|
| 1Ô∏è‚É£ Operating Leverage & Margin Expansion | | | |
| 2Ô∏è‚É£ Sectoral Tailwinds | | | |
| 3Ô∏è‚É£ Product Mix Improvements | | | |
| 4Ô∏è‚É£ Capacity Expansion Plans | | | |
| 5Ô∏è‚É£ Insider Buying / Promoter Confidence | | | |
| 6Ô∏è‚É£ Geographical Expansion | | | |
| 7Ô∏è‚É£ Supply-Side Consolidation | | | |
| 8Ô∏è‚É£ Debt Reduction / ROE-ROCE Improvement | | | |
| 9Ô∏è‚É£ Operational Efficiency / Tech Adoption | | | |
| üîü Market Share Gains | | | |
| 11Ô∏è‚É£ Corporate Actions (M&A, Buyback, Spinoff) | | | |
| 12Ô∏è‚É£ Creating Optionality (Governance, ESG, Leadership) | | | |

PART 4 ‚Äî STRUCTURED SUMMARY
| Category | Assessment | Evidence |
|---|---|---|
| Management Tone | | |
| Financial Trends | | |
| Growth Drivers | | |
| Risks | | |
| Industry Position | | |
| Capital Allocation | | |
| Guidance | | |
| Sentiment | | |
| Rating | | |

üü¢ Positives:
üî¥ Negatives:
‚ö™ Neutrals:

PART 5 ‚Äî CONCLUSION
‚Ä¢ Overall Management Tone: Bullish / Cautious / Defensive
‚Ä¢ Key Triggers for Next Quarter:
‚Ä¢ Risks Mentioned or Implied:
‚Ä¢ Verdict: Strong Buy / Buy or Accumulate / Hold / Watchlist / Avoid
‚Ä¢ Analyst View (5 sentences): conviction level, growth potential, valuation comfort zone.
  If Buy, mention triggers that would upgrade to Strong Buy.

Transcript:
---
{TRANSCRIPT}
---`;

async function analyzeWithAI(transcript, title) {
  const prompt = ANALYSIS_PROMPT.replace("{TRANSCRIPT}", transcript.slice(0, 80000));
  const response = await fetch("https://api.anthropic.com/v1/messages", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      model: "claude-sonnet-4-20250514",
      max_tokens: 1000,
      messages: [{ role: "user", content: prompt }],
    }),
  });
  if (!response.ok) throw new Error(`Claude API error: ${response.status}`);
  const data = await response.json();
  return data.content.map(b => b.text || "").join("\n");
}

function LogLine({ time, type, msg }) {
  const colors = { info:"#47ffe8", ok:"#2ed573", err:"#ff4757", ai:"#e8ff47", msg:"#c0c0d0" };
  return (
    <div style={{display:"flex",gap:12,fontSize:12,lineHeight:"1.8",fontFamily:"'DM Mono',monospace",animation:"fadeIn 0.3s ease"}}>
      <span style={{color:"#444",flexShrink:0}}>{time}</span>
      <span style={{color:colors[type]||colors.msg}}>{msg}</span>
    </div>
  );
}

function StatusBadge({ status }) {
  const s = {
    Done:      {bg:"rgba(46,213,115,0.12)",color:"#2ed573",border:"rgba(46,213,115,0.3)"},
    Error:     {bg:"rgba(255,71,87,0.12)", color:"#ff4757",border:"rgba(255,71,87,0.3)"},
    Analyzing: {bg:"rgba(232,255,71,0.12)",color:"#e8ff47",border:"rgba(232,255,71,0.3)"},
    Pending:   {bg:"rgba(255,255,255,0.05)",color:"#555",  border:"rgba(255,255,255,0.1)"},
  }[status] || {bg:"rgba(255,255,255,0.05)",color:"#555",border:"rgba(255,255,255,0.1)"};
  return (
    <span style={{fontSize:10,fontFamily:"'DM Mono',monospace",padding:"3px 10px",borderRadius:4,
      background:s.bg,color:s.color,border:`1px solid ${s.border}`,letterSpacing:1,
      textTransform:"uppercase",flexShrink:0}}>
      {status}
    </span>
  );
}

function App() {
  const today   = new Date().toISOString().split("T")[0];
  const weekAgo = new Date(Date.now()-7*86400000).toISOString().split("T")[0];

  // Mode
  const [mode, setMode] = useState("manual");

  // Manual fields
  const [fromDate, setFromDate] = useState(weekAgo);
  const [toDate, setToDate]     = useState(today);

  // Common
  const [email, setEmail] = useState("");

  // Interval config
  const [intervalValue, setIntervalValue] = useState(1);
  const [intervalUnit, setIntervalUnit]   = useState("hour");

  // Daily config
  const [dailyTime, setDailyTime] = useState("08:00");

  // Schedule state ‚Äî stored in Render backend (cloud)
  const [scheduleActive, setScheduleActive]   = useState(false);
  const [scheduleDetails, setScheduleDetails] = useState(null);
  const [scheduleLoading, setScheduleLoading] = useState(false);
  const scheduleRef = useRef(null);

  // Run state
  const [running, setRunning]     = useState(false);
  const [logs, setLogs]           = useState([]);
  const [videos, setVideos]       = useState([]);
  const [progress, setProgress]   = useState(0);
  const [emailSent, setEmailSent] = useState(false);
  const logsRef = useRef(null);

  useEffect(() => {
    if (logsRef.current) logsRef.current.scrollTop = logsRef.current.scrollHeight;
  }, [logs]);

  useEffect(() => {
    return () => { if (scheduleRef.current) clearTimeout(scheduleRef.current); };
  }, []);

  // Persist config to localStorage
  const ts = () => new Date().toLocaleTimeString("en-US",{hour12:false});
  const addLog = (msg, type="msg") => setLogs(p=>[...p,{time:ts(),msg,type}]);
  const updateVideo = (idx, patch) => setVideos(p=>p.map((v,i)=>i===idx?{...v,...patch}:v));

  // Poll backend logs every 5s to show server-side activity from any device
  const lastLogTimeRef = useRef(null);
  useEffect(() => {
    async function pollLogs() {
      try {
        const r = await fetch(`${API_BASE}/api/logs?limit=50`);
        if (!r.ok) return;
        const data = await r.json();
        const entries = data.logs || [];
        if (!entries.length) return;
        const newest = entries[entries.length - 1].time;
        if (newest === lastLogTimeRef.current) return; // no new entries
        // Find new entries since last poll
        const lastTime = lastLogTimeRef.current;
        const newEntries = lastTime
          ? entries.filter(e => e.time > lastTime)
          : entries;
        if (newEntries.length > 0) {
          setLogs(prev => {
            const existing = new Set(prev.map(l => l._id));
            const toAdd = newEntries
              .filter(e => !existing.has(e.time))
              .map(e => ({
                time: new Date(e.time).toLocaleTimeString("en-US",{hour12:false}),
                type: e.level,
                msg: e.msg,
                _id: e.time,
                _server: true,
              }));
            return toAdd.length ? [...prev, ...toAdd] : prev;
          });
          lastLogTimeRef.current = newest;
        }
      } catch(e) { /* silent */ }
    }
    // Poll immediately then every 5s
    pollLogs();
    const interval = setInterval(pollLogs, 5000);
    return () => clearInterval(interval);
  }, []);

  // Load schedule from cloud backend on page load
  useEffect(() => {
    async function loadSchedule() {
      try {
        const r = await fetch(`${API_BASE}/api/schedule`);
        if (r.ok) {
          const data = await r.json();
          if (data.active) {
            setScheduleActive(true);
            setScheduleDetails(data);
            setMode(data.mode || "interval");
            setEmail(data.email || "");
            setIntervalValue(data.intervalValue || 1);
            setIntervalUnit(data.intervalUnit || "hour");
            setDailyTime(data.dailyTime || "08:00");
            addLog("‚òÅÔ∏è Active schedule loaded from cloud.", "ok");
          }
        }
      } catch(e) { /* silent fail */ }
    }
    loadSchedule();
  }, []);

  function getLast24h() {
    const now  = new Date();
    const past = new Date(Date.now()-24*60*60*1000);
    return { from: past.toISOString().split("T")[0], to: now.toISOString().split("T")[0] };
  }

  function getNextRunTime() {
    if (mode==="interval") {
      const ms = intervalUnit==="minute" ? intervalValue*60000 : intervalValue*3600000;
      return new Date(Date.now()+ms);
    }
    if (mode==="daily") {
      const [h,m] = dailyTime.split(":").map(Number);
      const next = new Date(); next.setHours(h,m,0,0);
      if (next<=new Date()) next.setDate(next.getDate()+1);
      return next;
    }
    return null;
  }

  function scheduleLabel() {
    if (mode==="interval") return `Every ${intervalValue} ${intervalUnit}(s)`;
    if (mode==="daily")    return `Daily at ${dailyTime}`;
    return "";
  }

  async function runAnalysis(isScheduled=false) {
    const dates = isScheduled ? getLast24h() : { from: fromDate, to: toDate };

    if (!email) { alert("Please enter email."); return; }
    if (!dates.from||!dates.to) { alert("Please set dates."); return; }

    setRunning(true); setLogs([]); setVideos([]); setProgress(0); setEmailSent(false);

    addLog(isScheduled?"‚è∞ Scheduled run triggered ‚Äî fetching last 24 hours...":"Initializing earnings intelligence pipeline...","info");
    addLog(`Date range: ${dates.from} ‚Üí ${dates.to}${isScheduled?" (last 24 hours)":""}`, "msg");
    addLog(`Email: ${email}`, "msg");

    try {
      addLog("Connecting to @trendlyne YouTube channel...", "info");
      setProgress(10);

      const vRes = await fetch(`${API_BASE}/api/fetch-videos`,{
        method:"POST", headers:{"Content-Type":"application/json"},
        body: JSON.stringify({from_date:dates.from, to_date:dates.to}),
      });
      if (!vRes.ok) throw new Error(`Failed to fetch videos: ${vRes.statusText}`);
      const vData = await vRes.json();

      if (!vData.videos?.length) {
        addLog("‚ö† No earnings call videos found in this date range.", "err");
        addLog("Try extending your date range.", "msg");
        setRunning(false); return;
      }

      // Filter only earnings call videos
      const earningsVideos = vData.videos.filter(v =>
        v.title.toLowerCase().includes("earnings call")
      );
      addLog(`‚úì Found ${earningsVideos.length} earnings call(s) (filtered from ${vData.videos.length} total)`, "ok");
      if (!earningsVideos.length) {
        addLog("‚ö† No earnings call videos found in this date range.", "err");
        setRunning(false); return;
      }
      vData.videos = earningsVideos;
      setVideos(earningsVideos.map(v=>({...v,status:"Pending",analysis:""})));
      setProgress(20);

      const analyses = [];
      for (let i=0; i<vData.videos.length; i++) {
        const v = vData.videos[i];
        const pct = 20+Math.round(((i+1)/vData.videos.length)*65);
        addLog(`[${i+1}/${vData.videos.length}] Fetching transcript: ${v.title}`, "info");
        updateVideo(i, {status:"Analyzing"});

        try {
          addLog(`Fetching transcript...`, "info");
          let transcript = "";
          const supadataKeys = [
            "sd_a96006039b0ec279e7ab80fb28098c82",
            "sd_9e4ca6a05a68b38c4e8dc5f04cb27a30",
            "sd_91298bda05c18ac2de5b58b31567aabe",
          ];
          for (const key of supadataKeys) {
            try {
              const sdRes = await fetch(
                `https://api.supadata.ai/v1/youtube/transcript?videoId=${v.video_id}&text=true`,
                { headers: { "x-api-key": key } }
              );
              if (sdRes.ok) {
                const sdData = await sdRes.json();
                transcript = sdData.content || sdData.transcript || sdData.text || "";
                if (transcript.length>100) break;
              }
            } catch(e) {}
          }

          if (!transcript) {
            addLog(`‚ö† No transcript for: ${v.title}`, "err");
            updateVideo(i, {status:"Error", analysis:"No transcript available."});
            analyses.push({...v, analysis:"No transcript available for this video."});
            continue;
          }

          addLog(`‚úì Got transcript (${Math.round(transcript.length/1000)}k chars) ‚Äî running AI analysis...`, "ai");
          const analysis = await analyzeWithAI(transcript, v.title);
          updateVideo(i, {status:"Done", analysis});
          analyses.push({...v, analysis});
          addLog(`‚úì Analysis complete: ${v.title}`, "ok");
          setProgress(pct);

        } catch(err) {
          addLog(`‚úó Failed: ${v.title} ‚Äî ${err.message}`, "err");
          updateVideo(i, {status:"Error", analysis:`Error: ${err.message}`});
          analyses.push({...v, analysis:`Analysis failed: ${err.message}`});
        }
      }

      setProgress(92);
      addLog("Sending email report...", "ai");
      const eRes = await fetch(`${API_BASE}/api/send-report`,{
        method:"POST", headers:{"Content-Type":"application/json"},
        body: JSON.stringify({email, analyses, from_date:dates.from, to_date:dates.to}),
      });
      if (!eRes.ok) throw new Error(`Email failed: ${eRes.statusText}`);

      setProgress(100);
      addLog(`‚úì Report delivered to ${email}`, "ok");
      addLog("Pipeline complete! Check your inbox.", "info");
      setEmailSent(true);

    } catch(err) {
      addLog(`‚úó Fatal error: ${err.message}`, "err");
    } finally {
      setRunning(false);
    }
  }

  // scheduleNext removed ‚Äî backend handles scheduling via cron loop

  async function startSchedule() {
    if (!email) return alert("Please enter your email first.");
    setScheduleLoading(true);
    try {
      const r = await fetch(`${API_BASE}/api/schedule`, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ mode, email, intervalValue, intervalUnit, dailyTime }),
      });
      if (!r.ok) throw new Error(await r.text());
      const data = await r.json();
      setScheduleActive(true);
      setScheduleDetails(data.schedule);
      addLog(`‚òÅÔ∏è Schedule saved to cloud ‚Äî ${scheduleLabel()}`, "ok");
      addLog(`Next run at: ${new Date(data.schedule.next_run).toLocaleString()}`, "msg");
    } catch(e) {
      addLog(`‚úó Failed to start schedule: ${e.message}`, "err");
    } finally {
      setScheduleLoading(false);
    }
  }

  async function stopSchedule() {
    if (scheduleRef.current) clearTimeout(scheduleRef.current);
    setScheduleLoading(true);
    try {
      await fetch(`${API_BASE}/api/schedule`, { method: "DELETE" });
    } catch(e) {}
    setScheduleActive(false);
    setScheduleDetails(null);
    setScheduleLoading(false);
    addLog("‚èπ Schedule cancelled.", "err");
  }

  function editSchedule() {
    stopSchedule();
    setLogs([]);
  }

  const inputStyle = {
    width:"100%", background:"rgba(255,255,255,0.03)", border:"1px solid #1e1e2e",
    borderRadius:6, padding:"11px 14px", color:"#f0f0f5",
    fontFamily:"'DM Mono',monospace", fontSize:13, transition:"all 0.2s"
  };
  const labelStyle = {
    display:"block", fontSize:10, letterSpacing:2, color:"#555",
    textTransform:"uppercase", marginBottom:8, fontFamily:"Syne,sans-serif", fontWeight:700
  };

  return (
    <div style={{
      minHeight:"100vh", background:"#0a0a0f", color:"#f0f0f5",
      fontFamily:"'DM Mono',monospace", padding:"0 0 60px", position:"relative", overflow:"hidden",
      backgroundImage:"linear-gradient(rgba(232,255,71,0.025) 1px,transparent 1px),linear-gradient(90deg,rgba(232,255,71,0.025) 1px,transparent 1px)",
      backgroundSize:"56px 56px"
    }}>
      <div style={{position:"fixed",width:600,height:600,borderRadius:"50%",background:"#e8ff47",
        filter:"blur(120px)",top:-200,right:-200,opacity:0.08,pointerEvents:"none",animation:"drift1 12s ease-in-out infinite"}}/>
      <div style={{position:"fixed",width:400,height:400,borderRadius:"50%",background:"#47ffe8",
        filter:"blur(120px)",bottom:-100,left:-100,opacity:0.08,pointerEvents:"none",animation:"drift2 15s ease-in-out infinite"}}/>

      <div style={{maxWidth:820,margin:"0 auto",padding:"0 24px",position:"relative",zIndex:1}}>

        {/* Header */}
        <div style={{padding:"48px 0 32px",borderBottom:"1px solid #1e1e2e"}}>
          <div style={{display:"inline-flex",alignItems:"center",gap:8,
            background:"rgba(232,255,71,0.07)",border:"1px solid rgba(232,255,71,0.2)",
            borderRadius:4,padding:"4px 12px",fontSize:10,letterSpacing:2,color:"#e8ff47",
            textTransform:"uppercase",marginBottom:20,fontFamily:"Syne,sans-serif",fontWeight:700}}>
            <span style={{width:6,height:6,background:"#e8ff47",borderRadius:"50%",
              animation:"pulse 2s infinite",display:"inline-block"}}/>
            Open Source ¬∑ Free ¬∑ AI-Powered
          </div>
          <h1 style={{fontFamily:"'DM Serif Display',serif",fontSize:"clamp(34px,6vw,52px)",
            lineHeight:1.1,letterSpacing:-1,marginBottom:12}}>
            Earnings<br/><em style={{color:"#e8ff47"}}>Intelligence</em>
          </h1>
          <p style={{fontSize:13,color:"#555",lineHeight:1.7,maxWidth:480}}>
            Fetch @trendlyne earnings call transcripts, run deep AI equity analysis,
            and receive a comprehensive report in your inbox.
          </p>
        </div>

        {/* Stats */}
        <div style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:1,
          background:"#1e1e2e",border:"1px solid #1e1e2e",borderRadius:8,overflow:"hidden",margin:"32px 0"}}>
          {[["üì∫","Source","@trendlyne"],["ü§ñ","AI Engine","OpenRouter (Free)"],["üìß","Delivery","Per-Call Email"]].map(([icon,label,val])=>(
            <div key={label} style={{background:"#111118",padding:"18px 20px",textAlign:"center"}}>
              <div style={{fontSize:22,marginBottom:6}}>{icon}</div>
              <div style={{fontSize:10,letterSpacing:2,color:"#555",textTransform:"uppercase",
                marginBottom:4,fontFamily:"Syne,sans-serif",fontWeight:700}}>{label}</div>
              <div style={{fontSize:12,color:"#e8ff47",fontWeight:600}}>{val}</div>
            </div>
          ))}
        </div>

        {/* Main Form */}
        <div style={{background:"#111118",border:"1px solid #1e1e2e",borderRadius:12,
          padding:32,marginBottom:24,position:"relative",overflow:"hidden"}}>
          <div style={{position:"absolute",top:0,left:0,right:0,height:1,
            background:"linear-gradient(90deg,transparent,rgba(232,255,71,0.4),transparent)"}}/>

          {/* ‚îÄ‚îÄ STEP 1: RUN MODE ‚îÄ‚îÄ */}
          <div style={{marginBottom:28}}>
            <label style={labelStyle}>
              <span style={{color:"#e8ff47"}}>//&nbsp;</span>Step 1 ‚Äî Select Run Mode
            </label>
            <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8}}>
              {[
                ["manual",  "‚ñ∂",  "Manual",   "Run once with custom dates"],
                ["interval","üîÅ", "Interval", "Repeat every X mins/hours"],
                ["daily",   "üìÖ", "Daily",    "Run once a day at set time"],
              ].map(([m, icon, title, desc])=>(
                <button key={m} onClick={()=>{setMode(m);if(scheduleActive)stopSchedule();}}
                  style={{padding:"14px 10px",border:`1px solid ${mode===m?"#e8ff47":"#1e1e2e"}`,
                    background:mode===m?"rgba(232,255,71,0.07)":"transparent",
                    color:mode===m?"#e8ff47":"#555",borderRadius:8,cursor:"pointer",
                    textAlign:"center",transition:"all 0.15s"}}>
                  <div style={{fontSize:20,marginBottom:6}}>{icon}</div>
                  <div style={{fontFamily:"Syne,sans-serif",fontSize:12,fontWeight:800,
                    letterSpacing:1,textTransform:"uppercase",marginBottom:4}}>{title}</div>
                  <div style={{fontSize:10,color:mode===m?"#888":"#333",lineHeight:1.4}}>{desc}</div>
                </button>
              ))}
            </div>
          </div>

          {/* ‚îÄ‚îÄ STEP 2: CONFIG ‚îÄ‚îÄ */}
          <div style={{marginBottom:24}}>
            <label style={labelStyle}>
              <span style={{color:"#e8ff47"}}>//&nbsp;</span>Step 2 ‚Äî Configure
            </label>

            {/* MANUAL: date range + email */}
            {mode==="manual" && (
              <>
                <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginBottom:16}}>
                  <div>
                    <label style={labelStyle}>FROM DATE</label>
                    <input type="date" value={fromDate} onChange={e=>setFromDate(e.target.value)} style={inputStyle}/>
                  </div>
                  <div>
                    <label style={labelStyle}>TO DATE</label>
                    <input type="date" value={toDate} onChange={e=>setToDate(e.target.value)} style={inputStyle}/>
                  </div>
                </div>
                <div>
                  <label style={labelStyle}>RECIPIENT EMAIL</label>
                  <input type="email" placeholder="analyst@example.com" value={email}
                    onChange={e=>setEmail(e.target.value)} style={inputStyle}/>
                </div>
              </>
            )}

            {/* INTERVAL: value + unit + email */}
            {mode==="interval" && !scheduleActive && (
              <>
                <div style={{background:"rgba(232,255,71,0.04)",border:"1px solid rgba(232,255,71,0.15)",
                  borderRadius:6,padding:"10px 14px",marginBottom:16,fontSize:11,color:"#888",lineHeight:1.6}}>
                  üìÖ Dates are auto-set to <strong style={{color:"#e8ff47"}}>last 24 hours</strong> on each scheduled run.
                </div>
                <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginBottom:16}}>
                  <div>
                    <label style={labelStyle}>REPEAT EVERY</label>
                    <input type="number" min={1} max={60} value={intervalValue}
                      onChange={e=>setIntervalValue(Number(e.target.value))} style={inputStyle}/>
                  </div>
                  <div>
                    <label style={labelStyle}>UNIT</label>
                    <select value={intervalUnit} onChange={e=>setIntervalUnit(e.target.value)}
                      style={{...inputStyle,cursor:"pointer"}}>
                      <option value="minute">Minutes</option>
                      <option value="hour">Hours</option>
                    </select>
                  </div>
                </div>
                <div>
                  <label style={labelStyle}>RECIPIENT EMAIL</label>
                  <input type="email" placeholder="analyst@example.com" value={email}
                    onChange={e=>setEmail(e.target.value)} style={inputStyle}/>
                </div>
              </>
            )}

            {/* DAILY: time + email */}
            {mode==="daily" && !scheduleActive && (
              <>
                <div style={{background:"rgba(232,255,71,0.04)",border:"1px solid rgba(232,255,71,0.15)",
                  borderRadius:6,padding:"10px 14px",marginBottom:16,fontSize:11,color:"#888",lineHeight:1.6}}>
                  üìÖ Dates are auto-set to <strong style={{color:"#e8ff47"}}>last 24 hours</strong> on each scheduled run.
                </div>
                <div style={{marginBottom:16}}>
                  <label style={labelStyle}>RUN DAILY AT</label>
                  <input type="time" value={dailyTime} onChange={e=>setDailyTime(e.target.value)} style={inputStyle}/>
                </div>
                <div>
                  <label style={labelStyle}>RECIPIENT EMAIL</label>
                  <input type="email" placeholder="analyst@example.com" value={email}
                    onChange={e=>setEmail(e.target.value)} style={inputStyle}/>
                </div>
              </>
            )}
          </div>

          {/* Progress bar */}
          {running && (
            <div style={{background:"rgba(255,255,255,0.05)",borderRadius:2,height:3,marginBottom:16,overflow:"hidden"}}>
              <div style={{height:"100%",background:"linear-gradient(90deg,#e8ff47,#47ffe8)",
                borderRadius:2,width:`${progress}%`,transition:"width 0.5s ease"}}/>
            </div>
          )}

          {/* ‚îÄ‚îÄ ACTION BUTTON ‚îÄ‚îÄ */}
          {!scheduleActive && (
            <button
              onClick={mode==="manual" ? ()=>runAnalysis(false) : startSchedule}
              disabled={running}
              style={{width:"100%",padding:14,
                background:running?"rgba(232,255,71,0.4)":"#e8ff47",
                color:"#0a0a0f",border:"none",borderRadius:6,fontFamily:"Syne,sans-serif",
                fontSize:13,fontWeight:800,letterSpacing:2,textTransform:"uppercase",
                cursor:running?"not-allowed":"pointer",transition:"all 0.15s",
                display:"flex",alignItems:"center",justifyContent:"center",gap:8}}>
              <span style={{fontSize:16}}>
                {running?"‚è≥":mode==="manual"?"‚ö°":"‚ñ∂"}
              </span>
              {running?"Analyzing...":scheduleLoading?"Saving...":mode==="manual"?"Run Analysis":"Start Schedule"}
            </button>
          )}
        </div>

        {/* ‚îÄ‚îÄ SCHEDULE ACTIVE PANEL ‚îÄ‚îÄ */}
        {scheduleActive && scheduleDetails && (
          <div style={{background:"#111118",border:"1px solid rgba(46,213,115,0.3)",borderRadius:12,
            padding:28,marginBottom:24,position:"relative",overflow:"hidden"}}>
            <div style={{position:"absolute",top:0,left:0,right:0,height:1,
              background:"linear-gradient(90deg,transparent,rgba(46,213,115,0.5),transparent)"}}/>

            <div style={{display:"flex",alignItems:"center",gap:10,marginBottom:20}}>
              <span style={{width:8,height:8,background:"#2ed573",borderRadius:"50%",
                animation:"pulse 1.5s infinite",display:"inline-block"}}/>
              <span style={{fontFamily:"Syne,sans-serif",fontSize:13,fontWeight:800,
                color:"#2ed573",letterSpacing:2,textTransform:"uppercase"}}>Schedule Active</span>
            </div>

            <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:12,marginBottom:20}}>
              {[
                ["‚è∞","Frequency", scheduleDetails.label || scheduleLabel()],
                ["üìÖ","Next Run",  scheduleDetails.next_run ? new Date(scheduleDetails.next_run).toLocaleString() : "Calculating..."],
                ["‚úÖ","Runs Done", scheduleDetails.run_count ?? 0],
              ].map(([icon,label,val])=>(
                <div key={label} style={{background:"rgba(255,255,255,0.03)",border:"1px solid #1e1e2e",
                  borderRadius:8,padding:"14px 16px"}}>
                  <div style={{fontSize:18,marginBottom:6}}>{icon}</div>
                  <div style={{fontSize:10,letterSpacing:2,color:"#555",textTransform:"uppercase",
                    marginBottom:4,fontFamily:"Syne,sans-serif",fontWeight:700}}>{label}</div>
                  <div style={{fontSize:12,color:"#f0f0f5",fontWeight:600}}>{val}</div>
                </div>
              ))}
            </div>

            <div style={{background:"rgba(232,255,71,0.04)",border:"1px solid rgba(232,255,71,0.15)",
              borderRadius:6,padding:"10px 14px",marginBottom:20,fontSize:11,color:"#888"}}>
              ‚òÅÔ∏è Runs on Render server ‚Äî works even when browser is closed &nbsp;|&nbsp;
              üìß Reports sent to <strong style={{color:"#e8ff47"}}>{scheduleDetails.email || email}</strong> &nbsp;|&nbsp;
              üìÖ Fetches <strong style={{color:"#e8ff47"}}>last 24 hours</strong> each run
            </div>

            <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10}}>
              <button onClick={editSchedule}
                style={{padding:12,background:"rgba(255,255,255,0.05)",border:"1px solid #1e1e2e",
                  color:"#f0f0f5",borderRadius:6,fontFamily:"Syne,sans-serif",fontSize:12,
                  fontWeight:800,letterSpacing:2,textTransform:"uppercase",cursor:"pointer",
                  display:"flex",alignItems:"center",justifyContent:"center",gap:8}}>
                ‚úèÔ∏è Edit Schedule
              </button>
              <button onClick={stopSchedule}
                style={{padding:12,background:"rgba(255,71,87,0.1)",border:"1px solid rgba(255,71,87,0.4)",
                  color:"#ff4757",borderRadius:6,fontFamily:"Syne,sans-serif",fontSize:12,
                  fontWeight:800,letterSpacing:2,textTransform:"uppercase",cursor:"pointer",
                  display:"flex",alignItems:"center",justifyContent:"center",gap:8}}>
                ‚èπ Cancel Schedule
              </button>
            </div>

            {/* Can still run manually while scheduled */}
            <button onClick={()=>runAnalysis(true)} disabled={running}
              style={{width:"100%",marginTop:10,padding:11,
                background:running?"rgba(232,255,71,0.2)":"rgba(232,255,71,0.08)",
                border:"1px solid rgba(232,255,71,0.2)",color:"#e8ff47",
                borderRadius:6,fontFamily:"Syne,sans-serif",fontSize:11,fontWeight:800,
                letterSpacing:2,textTransform:"uppercase",cursor:running?"not-allowed":"pointer",
                display:"flex",alignItems:"center",justifyContent:"center",gap:8}}>
              {running?"‚è≥ Running...":"‚ö° Run Now (Last 24h) ‚Äî Manual Trigger"}
            </button>
          </div>
        )}

        {/* Terminal */}
        {(logs.length>0 || scheduleActive) && (
          <div style={{background:"#08080f",border:"1px solid #1e1e2e",borderRadius:8,overflow:"hidden",marginBottom:24}}>
            <div style={{padding:"10px 16px",background:"#111118",borderBottom:"1px solid #1e1e2e",
              display:"flex",alignItems:"center",gap:12,fontSize:11,color:"#555",fontFamily:"'DM Mono',monospace"}}>
              <div style={{display:"flex",gap:5}}>
                {["#ff5f57","#febc2e","#28c840"].map(c=>(
                  <div key={c} style={{width:10,height:10,borderRadius:"50%",background:c}}/>
                ))}
              </div>
              <span style={{flex:1}}>earnings-analyzer.log &nbsp;
                <span style={{color:"#2ed573",fontSize:9,letterSpacing:1}}>‚óè LIVE</span>
              </span>
              <button onClick={async()=>{
                await fetch(`${API_BASE}/api/logs`,{method:"DELETE"});
                setLogs([]);
                lastLogTimeRef.current = null;
              }} style={{background:"none",border:"1px solid #1e1e2e",color:"#555",
                borderRadius:4,padding:"2px 8px",cursor:"pointer",fontSize:10,
                fontFamily:"'DM Mono',monospace"}}>
                Clear
              </button>
            </div>
            <div ref={logsRef} style={{padding:"16px 20px",maxHeight:280,overflowY:"auto"}}>
              {logs.map((l,i)=>(
                <div key={i} style={{display:"flex",gap:12,fontSize:12,lineHeight:"1.8",
                  fontFamily:"'DM Mono',monospace",animation:"fadeIn 0.3s ease"}}>
                  <span style={{color:"#444",flexShrink:0}}>{l.time}</span>
                  <span style={{color:{info:"#47ffe8",ok:"#2ed573",err:"#ff4757",ai:"#e8ff47",msg:"#c0c0d0"}[l.type]||"#c0c0d0"}}>{l.msg}</span>
                </div>
              ))}
              {running && <span style={{display:"inline-block",width:7,height:12,background:"#e8ff47",
                verticalAlign:"middle",animation:"blink 1s step-end infinite",marginLeft:6}}/>}
            </div>
          </div>
        )}

        {/* Results */}
        {videos.length>0 && (
          <div style={{marginBottom:24}}>
            <div style={{fontSize:10,letterSpacing:3,color:"#555",textTransform:"uppercase",
              marginBottom:14,fontFamily:"Syne,sans-serif",fontWeight:700}}>
              <span style={{color:"#2ed573"}}>//&nbsp;</span>Analysis Results
            </div>
            {videos.map((v,i)=>(
              <div key={i} style={{background:"#111118",border:"1px solid #1e1e2e",borderRadius:8,
                padding:"16px 20px",marginBottom:10,display:"flex",alignItems:"flex-start",gap:14}}>
                <span style={{fontSize:18,flexShrink:0,marginTop:2}}>
                  {v.status==="Done"?"‚úÖ":v.status==="Error"?"‚ùå":v.status==="Analyzing"?"‚è≥":"üìÑ"}
                </span>
                <div style={{flex:1,minWidth:0}}>
                  <div style={{fontFamily:"Syne,sans-serif",fontSize:13,fontWeight:700,
                    marginBottom:3,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>
                    {v.title}
                  </div>
                  <div style={{fontSize:11,color:"#555"}}>Published: {v.published_date}</div>
                </div>
                <span style={{fontSize:10,fontFamily:"'DM Mono',monospace",padding:"3px 10px",
                  borderRadius:4,flexShrink:0,textTransform:"uppercase",letterSpacing:1,
                  background:{Done:"rgba(46,213,115,0.12)",Error:"rgba(255,71,87,0.12)",
                    Analyzing:"rgba(232,255,71,0.12)",Pending:"rgba(255,255,255,0.05)"}[v.status]||"rgba(255,255,255,0.05)",
                  color:{Done:"#2ed573",Error:"#ff4757",Analyzing:"#e8ff47",Pending:"#555"}[v.status]||"#555",
                  border:`1px solid ${{Done:"rgba(46,213,115,0.3)",Error:"rgba(255,71,87,0.3)",
                    Analyzing:"rgba(232,255,71,0.3)",Pending:"rgba(255,255,255,0.1)"}[v.status]||"rgba(255,255,255,0.1)"}`}}>
                  {v.status}
                </span>
              </div>
            ))}
          </div>
        )}

        {/* Success */}
        {emailSent && (
          <div style={{background:"rgba(46,213,115,0.06)",border:"1px solid rgba(46,213,115,0.2)",
            borderRadius:8,padding:"20px 24px",display:"flex",alignItems:"center",gap:16}}>
            <span style={{fontSize:28}}>‚úâÔ∏è</span>
            <div>
              <div style={{fontFamily:"Syne,sans-serif",fontSize:14,fontWeight:800,color:"#2ed573",marginBottom:4}}>
                Report Delivered!
              </div>
              <div style={{fontSize:12,color:"#2ed573"}}>
                Individual analysis emails sent to <strong>{email}</strong>
              </div>
            </div>
          </div>
        )}

      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
